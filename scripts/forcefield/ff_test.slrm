#!/bin/bash
#SBATCH -J forcefield_test
#SBATCH -N 5
#SBATCH --ntasks=5
#SBATCH --ntasks-per-core=1
#SBATCH --mail-type=BEGIN,END
#SBATCH --mail-user=<bstadlbauer@posteo.de>
#SBATCH --mail-user=<gregor.mitscha-baude@gmx.at>

export I_MPI_PMI_LIBRARY=/cm/shared/apps/slurm/current/lib/libpmi.so

# module load intel/16 intel-mpi/5 intel-mkl/11 cmake/3.6.2 parmetis/4.0.3 python/2.7 mpi4py/2.0.0 numpy/1.9.1 petsc/3.7.5 petsc4py/3.7.0
# module load intel/16 eigen/3.2.4 intel-mkl/11 cmake/3.6.2 python/2.7 swig/3.0.10 boost/1.58.0 numpy/1.9.1 fenics/2016.2.0
# module load matplotlib/1.5.3 scipy/0.18.0

module load intel/16 intel-mpi/5 eigen/3.2.4 intel-mkl/11 cmake/3.6.2 parmetis/4.0.3 python/2.7 swig/3.0.10 boost/1.58.0 mpi4py/2.0.0 numpy/1.9.1 petsc/3.7.5 petsc4py/3.7.0 fenics/2016.2.0
module load matplotlib/1.5.3

NN=5

points=$(python nanopores/scripts/forcefield/print_test_points.py N $NN)
node=0
for p in $points; do
    echo $p
    srun -q -l -N1 -r$node CC=mpiicc CXX=mpiicpc python nanopores/scripts/forcefield/ff_one.py x0 $p &
    node=$(($node+1))
done
wait                    
